---
apiVersion: v1
kind: Namespace
metadata:
  name: cert-discovery-app
  labels:
    app: cert-discovery
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cert-discovery-sa
  namespace: cert-discovery-app
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cert-discovery-role
rules:
- apiGroups: [""]
  resources: ["secrets", "configmaps", "namespaces"]
  verbs: ["get", "list"]
- apiGroups: ["config.openshift.io"]
  resources: ["infrastructures"]
  verbs: ["get"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cert-discovery-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cert-discovery-role
subjects:
- kind: ServiceAccount
  name: cert-discovery-sa
  namespace: cert-discovery-app
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cert-discovery-app
  namespace: cert-discovery-app
  labels:
    app: cert-discovery
spec:
  replicas: 1
  selector:
    matchLabels:
      app: cert-discovery
  template:
    metadata:
      labels:
        app: cert-discovery
    spec:
      serviceAccountName: cert-discovery-sa
      containers:
      - name: cert-discovery
        image: registry.redhat.io/ubi9/python-311:latest
        command: ["/bin/bash", "-c"]
        args:
        - |
          pip3 install Flask==3.0.0 kubernetes==28.1.0 python-dateutil==2.8.2 cryptography==41.0.7 && \
          python3 /app/app.py
        workingDir: /app
        ports:
        - containerPort: 8080
          name: http
        volumeMounts:
        - name: app-code
          mountPath: /app
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: 1000m
            memory: 2Gi
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 30
          timeoutSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
        securityContext:
          allowPrivilegeEscalation: false
          runAsNonRoot: true
          capabilities:
            drop:
            - ALL
          seccompProfile:
            type: RuntimeDefault
      volumes:
      - name: app-code
        configMap:
          name: cert-discovery-app-code
      securityContext:
        runAsNonRoot: true
      restartPolicy: Always
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cert-discovery-app-code
  namespace: cert-discovery-app
data:
  app.py: |
    #!/usr/bin/env python3
    """
    OpenShift Certificate Discovery Web App
    Uses the logic from get-all-cluster-certificates.sh to discover and display
    all certificates in the cluster with management status and CA categories.
    """

    import os
    import base64
    import subprocess
    import json
    import re
    from datetime import datetime, timezone
    from flask import Flask, render_template_string, jsonify
    from kubernetes import client, config
    from kubernetes.client.rest import ApiException

    app = Flask(__name__)

    # Try to load in-cluster config, fallback to kubeconfig
    try:
        config.load_incluster_config()
    except:
        try:
            config.load_kube_config()
        except:
            pass

    def get_cert_fingerprint(cert_data):
        """Extract SHA256 fingerprint from certificate data."""
        if not cert_data:
            return ""
        
        try:
            # Extract first certificate from bundle if needed
            if "-----BEGIN CERTIFICATE-----" in cert_data:
                first_cert = cert_data.split("-----BEGIN CERTIFICATE-----")[1].split("-----END CERTIFICATE-----")[0]
                first_cert = "-----BEGIN CERTIFICATE-----\n" + first_cert + "\n-----END CERTIFICATE-----"
            else:
                first_cert = cert_data
            
            # Get SHA256 fingerprint using openssl
            result = subprocess.run(
                ['openssl', 'x509', '-noout', '-fingerprint', '-sha256'],
                input=first_cert.encode(),
                capture_output=True,
                text=True
            )
            if result.returncode == 0:
                fingerprint = result.stdout.split('=')[1].strip().replace(':', '').upper()
                return fingerprint
        except Exception as e:
            print(f"Error getting fingerprint: {e}")
        return ""

    def get_cert_issuer(cert_data):
        """Extract issuer from certificate data."""
        if not cert_data:
            return "N/A"
        
        try:
            # Extract first certificate from bundle if needed
            if "-----BEGIN CERTIFICATE-----" in cert_data:
                first_cert = cert_data.split("-----BEGIN CERTIFICATE-----")[1].split("-----END CERTIFICATE-----")[0]
                first_cert = "-----BEGIN CERTIFICATE-----\n" + first_cert + "\n-----END CERTIFICATE-----"
            else:
                first_cert = cert_data
            
            result = subprocess.run(
                ['openssl', 'x509', '-noout', '-issuer'],
                input=first_cert.encode(),
                capture_output=True,
                text=True
            )
            if result.returncode == 0:
                issuer = result.stdout.replace('issuer=', '').strip()
                return issuer
        except Exception as e:
            print(f"Error getting issuer: {e}")
        return "N/A"

    def get_cert_validity_days(cert_data):
        """Calculate certificate validity in days."""
        if not cert_data:
            return 0
        
        try:
            # Extract first certificate from bundle if needed
            if "-----BEGIN CERTIFICATE-----" in cert_data:
                first_cert = cert_data.split("-----BEGIN CERTIFICATE-----")[1].split("-----END CERTIFICATE-----")[0]
                first_cert = "-----BEGIN CERTIFICATE-----\n" + first_cert + "\n-----END CERTIFICATE-----"
            else:
                first_cert = cert_data
            
            result = subprocess.run(
                ['openssl', 'x509', '-noout', '-dates'],
                input=first_cert.encode(),
                capture_output=True,
                text=True
            )
            if result.returncode == 0:
                not_before = None
                not_after = None
                for line in result.stdout.split('\n'):
                    if 'notBefore=' in line:
                        not_before = line.split('=')[1].strip()
                    elif 'notAfter=' in line:
                        not_after = line.split('=')[1].strip()
                
                if not_before and not_after:
                    # Parse dates - simplified for now
                    from dateutil import parser
                    before_dt = parser.parse(not_before)
                    after_dt = parser.parse(not_after)
                    delta = after_dt - before_dt
                    return delta.days
        except Exception as e:
            print(f"Error getting validity: {e}")
        return 0

    def get_cert_expiry(cert_data):
        """Get certificate expiration date."""
        if not cert_data:
            return ""
        
        try:
            if "-----BEGIN CERTIFICATE-----" in cert_data:
                first_cert = cert_data.split("-----BEGIN CERTIFICATE-----")[1].split("-----END CERTIFICATE-----")[0]
                first_cert = "-----BEGIN CERTIFICATE-----\n" + first_cert + "\n-----END CERTIFICATE-----"
            else:
                first_cert = cert_data
            
            result = subprocess.run(
                ['openssl', 'x509', '-noout', '-enddate'],
                input=first_cert.encode(),
                capture_output=True,
                text=True
            )
            if result.returncode == 0:
                expiry = result.stdout.split('=')[1].strip()
                return expiry
        except Exception as e:
            print(f"Error getting expiry: {e}")
        return ""

    def determine_ca_category(issuer, annotations):
        """Determine CA category from issuer and annotations."""
        issuer_lower = issuer.lower()
        annotations_str = str(annotations).lower()
        
        # Service-CA
        if 'service-ca' in annotations_str or 'openshift-service-serving-signer' in issuer_lower:
            return "Service-CA"
        
        # Cluster-Proxy CA
        if 'open-cluster-management:cluster-proxy' in issuer_lower or 'cluster-proxy' in issuer_lower:
            return "Cluster-Proxy CA"
        
        # Kube-CSR-Signer
        if 'kube-csr-signer' in issuer_lower:
            return "Kube-CSR-Signer"
        
        # Cluster-Manager-Webhook
        if 'cluster-manager-webhook' in issuer_lower:
            return "Cluster-Manager-Webhook"
        
        # OVN CA
        if 'openshift-ovn-kubernetes' in issuer_lower:
            return "OVN CA"
        
        # Monitoring CA
        if 'openshift-cluster-monitoring' in issuer_lower:
            return "Monitoring CA"
        
        # Konnectivity CA
        if 'konnectivity-signer' in issuer_lower:
            return "Konnectivity CA"
        
        # Ingress CA
        if 'ingress-operator' in issuer_lower:
            return "Ingress CA"
        
        # OLM CA
        if 'olm-selfsigned' in issuer_lower:
            return "OLM CA"
        
        # External CA
        if 'accvraiz1' in issuer_lower or 'pkiaccv' in issuer_lower:
            return "External CA"
        
        # Platform-CA
        if 'root-ca' in issuer_lower or 'kube-apiserver-to-kubelet-signer' in issuer_lower:
            return "Platform-CA"
        
        # Generic platform patterns
        if any(x in issuer_lower for x in ['etcd', 'kube-apiserver', 'kube-controller-manager', 'openshift', 'kubernetes']):
            return "Platform-CA"
        
        return "Unknown"

    def is_platform_namespace(namespace):
        """Check if namespace is a platform namespace."""
        if namespace.startswith('openshift-') and namespace != 'openshift-config':
            return True
        if namespace.startswith('kubernetes-'):
            return True
        if namespace in ['openshift', 'openshift-config-managed', 'kube-system', 'kube-public', 'default', 'kubernetes']:
            return True
        return False

    def determine_managed_status(resource_type, name, namespace, cert_data, issuer, validity_days, annotations, labels):
        """Determine if certificate is platform-managed or user-managed."""
        owning_component = annotations.get('openshift.io/owning-component', '')
        cert_not_after = annotations.get('auth.openshift.io/certificate-not-after', '')
        cert_not_before = annotations.get('auth.openshift.io/certificate-not-before', '')
        managed_cert_type = labels.get('auth.openshift.io/managed-certificate-type', '')
        
        # Check if 10-year certificate
        is_10_year = validity_days >= 3650  # 10 years
        
        # kube-root-ca.crt special case
        if resource_type == 'configmap' and name == 'kube-root-ca.crt':
            if is_10_year:
                return "Platform-Managed (10-Year, Not Auto-Rotated)", "Kubernetes-managed configmap with platform certificates"
            return "Platform-Managed (Auto-Rotated)", "Kubernetes-managed configmap with platform certificates"
        
        # Check owning-component annotation
        if owning_component:
            return "Platform-Managed (Auto-Rotated)", f"Issuer: {issuer}; {validity_days} days validity"
        
        # Check platform namespace
        if is_platform_namespace(namespace):
            if is_10_year:
                return "Platform-Managed (10-Year, Not Auto-Rotated)", f"Issuer: {issuer}; {validity_days} days validity"
            if cert_not_after:
                return "Platform-Managed (Auto-Rotated)", f"Issuer: {issuer}; {validity_days} days validity"
            return "Platform-Managed (Auto-Rotated)", f"Issuer: {issuer}; {validity_days} days validity"
        
        # Check rotation annotation
        if cert_not_after:
            return "Platform-Managed (Auto-Rotated)", f"Issuer: {issuer}; {validity_days} days validity"
        
        # Check issuer patterns
        issuer_lower = issuer.lower()
        if 'service-ca' in issuer_lower or 'openshift-service-serving-signer' in issuer_lower:
            return "Platform-Managed (Auto-Rotated)", f"Service-CA signed; {validity_days} days validity"
        if 'root-ca' in issuer_lower or 'kube-apiserver' in issuer_lower or 'etcd' in issuer_lower:
            if is_10_year:
                return "Platform-Managed (10-Year, Not Auto-Rotated)", f"Platform-CA signed; {validity_days} days validity"
            return "Platform-Managed (Auto-Rotated)", f"Platform-CA signed; {validity_days} days validity"
        
        # Check managed label
        if managed_cert_type:
            if is_10_year:
                return "Platform-Managed (10-Year, Not Auto-Rotated)", f"Issuer: {issuer}; {validity_days} days validity"
            return "Platform-Managed (Auto-Rotated)", f"Issuer: {issuer}; {validity_days} days validity"
        
        # Default: User-Managed
        return "User-Managed (Not Auto-Rotated)", f"Issuer: {issuer}; {validity_days} days validity"

    def process_resource(v1, resource_type, name, namespace):
        """Process a secret or configmap to extract certificate information."""
        try:
            if resource_type == 'secret':
                obj = v1.read_namespaced_secret(name, namespace)
                data = obj.data or {}
                
                # Check for certificate fields
                cert_fields = []
                cert_data = None
                
                if 'tls.crt' in data:
                    cert_fields.append('tls.crt')
                    cert_data = base64.b64decode(data['tls.crt']).decode('utf-8', errors='ignore')
                elif 'ca.crt' in data:
                    cert_fields.append('ca.crt')
                    cert_data = base64.b64decode(data['ca.crt']).decode('utf-8', errors='ignore')
                elif 'cert.crt' in data:
                    cert_fields.append('cert.crt')
                    cert_data = base64.b64decode(data['cert.crt']).decode('utf-8', errors='ignore')
                
                if not cert_data:
                    return None
                
                annotations = obj.metadata.annotations or {}
                labels = obj.metadata.labels or {}
                
            elif resource_type == 'configmap':
                v1_cm = client.CoreV1Api()
                obj = v1_cm.read_namespaced_config_map(name, namespace)
                data = obj.data or {}
                
                cert_fields = []
                cert_data = None
                
                if 'ca-bundle.crt' in data:
                    cert_fields.append('ca-bundle.crt')
                    cert_data = data['ca-bundle.crt']
                elif 'tls.crt' in data:
                    cert_fields.append('tls.crt')
                    cert_data = data['tls.crt']
                elif 'ca.crt' in data:
                    cert_fields.append('ca.crt')
                    cert_data = data['ca.crt']
                elif 'cert.crt' in data:
                    cert_fields.append('cert.crt')
                    cert_data = data['cert.crt']
                
                if not cert_data:
                    return None
                
                annotations = obj.metadata.annotations or {}
                labels = obj.metadata.labels or {}
            else:
                return None
            
            # Extract certificate information
            fingerprint = get_cert_fingerprint(cert_data)
            issuer = get_cert_issuer(cert_data)
            validity_days = get_cert_validity_days(cert_data)
            expiry = get_cert_expiry(cert_data)
            validity_years = validity_days // 365 if validity_days > 0 else 0
            ca_category = determine_ca_category(issuer, annotations)
            managed_status, managed_details = determine_managed_status(
                resource_type, name, namespace, cert_data, issuer, validity_days, annotations, labels
            )
            
            # Build relevant annotations
            relevant_annos = []
            if 'openshift.io/owning-component' in annotations:
                relevant_annos.append(f"openshift.io/owning-component: {annotations['openshift.io/owning-component']}")
            if 'auth.openshift.io/certificate-not-before' in annotations:
                relevant_annos.append(f"auth.openshift.io/certificate-not-before: {annotations['auth.openshift.io/certificate-not-before']}")
            if 'auth.openshift.io/certificate-not-after' in annotations:
                relevant_annos.append(f"auth.openshift.io/certificate-not-after: {annotations['auth.openshift.io/certificate-not-after']}")
            
            return {
                'resource_type': resource_type,
                'name': name,
                'namespace': namespace,
                'data_fields': ', '.join(cert_fields),
                'validity_years': validity_years,
                'expiry': expiry,
                'fingerprint': fingerprint,
                'managed_status': managed_status,
                'managed_details': managed_details,
                'ca_category': ca_category,
                'relevant_annotations': '; '.join(relevant_annos) if relevant_annos else '',
                'issuer': issuer
            }
        except ApiException as e:
            if e.status != 404:
                print(f"Error processing {resource_type} {namespace}/{name}: {e}")
            return None
        except Exception as e:
            print(f"Error processing {resource_type} {namespace}/{name}: {e}")
            return None

    def discover_certificates():
        """Discover all certificates in the cluster."""
        v1 = client.CoreV1Api()
        certificates = []
        
        # Get all secrets
        try:
            secrets = v1.list_secret_for_all_namespaces()
            for secret in secrets.items:
                data = secret.data or {}
                # Check if has certificate fields
                if any(field in data for field in ['tls.crt', 'ca.crt', 'cert.crt']):
                    cert_info = process_resource(v1, 'secret', secret.metadata.name, secret.metadata.namespace)
                    if cert_info:
                        certificates.append(cert_info)
        except Exception as e:
            print(f"Error listing secrets: {e}")
        
        # Get all configmaps
        try:
            configmaps = v1.list_config_map_for_all_namespaces()
            for cm in configmaps.items:
                data = cm.data or {}
                # Check if has certificate fields
                if any(field in data for field in ['ca-bundle.crt', 'tls.crt', 'ca.crt', 'cert.crt']):
                    cert_info = process_resource(v1, 'configmap', cm.metadata.name, cm.metadata.namespace)
                    if cert_info:
                        certificates.append(cert_info)
        except Exception as e:
            print(f"Error listing configmaps: {e}")
        
        return certificates

    @app.route('/')
    def index():
        """Main page displaying certificate discovery results."""
        try:
            certificates = discover_certificates()
            
            # Get cluster info
            try:
                custom_api = client.CustomObjectsApi()
                infra = custom_api.get_cluster_custom_object('config.openshift.io', 'v1', 'infrastructures', 'cluster')
                cluster_name = infra.get('status', {}).get('infrastructureName', 'unknown-cluster')
            except:
                cluster_name = 'unknown-cluster'
            
            generated_time = datetime.now(timezone.utc).strftime('%Y-%m-%d %H:%M:%S UTC')
            
            # Statistics
            total = len(certificates)
            platform_managed = len([c for c in certificates if 'Platform-Managed' in c['managed_status']])
            user_managed = len([c for c in certificates if 'User-Managed' in c['managed_status']])
            auto_rotated = len([c for c in certificates if 'Auto-Rotated' in c['managed_status']])
            
            return render_template_string(HTML_TEMPLATE, 
                certificates=certificates,
                cluster_name=cluster_name,
                generated_time=generated_time,
                total=total,
                platform_managed=platform_managed,
                user_managed=user_managed,
                auto_rotated=auto_rotated
            )
        except Exception as e:
            return f"Error: {str(e)}", 500

    @app.route('/api/certificates')
    def api_certificates():
        """API endpoint returning JSON data."""
        try:
            certificates = discover_certificates()
            return jsonify(certificates)
        except Exception as e:
            return jsonify({'error': str(e)}), 500

    if __name__ == '__main__':
        app.run(host='0.0.0.0', port=8080, debug=False)

    # HTML Template with same color scheme
    HTML_TEMPLATE = '''
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>OpenShift Certificate Discovery</title>
        <meta http-equiv="refresh" content="300">
        <style>
            body {
                font-family: "RedHatText", Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                min-height: 100vh;
            }
            .header {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(10px);
                padding: 30px;
                border-radius: 15px;
                margin-bottom: 30px;
                box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .header h1 {
                margin: 0 0 10px 0;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            }
            .summary {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin: 20px 0;
            }
            .summary-card {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(10px);
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .summary-card h3 {
                margin: 0 0 10px 0;
                color: #3498db;
                font-size: 0.9em;
            }
            .summary-count {
                font-size: 2.5em;
                font-weight: bold;
                margin: 10px 0;
            }
            .cert-table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                background: rgba(0, 0, 0, 0.4);
                border-radius: 8px;
                overflow: hidden;
                font-size: 0.9em;
            }
            .cert-table th {
                background: rgba(52, 152, 219, 0.8);
                color: white;
                padding: 15px 12px;
                text-align: left;
                font-weight: bold;
                border-bottom: 2px solid #2980b9;
            }
            .cert-table td {
                padding: 12px;
                border-bottom: 1px solid rgba(255,255,255,0.1);
                vertical-align: top;
            }
            .cert-table tr:hover {
                background: rgba(52, 152, 219, 0.1);
            }
            .status-good { 
                background: rgba(46, 204, 113, 0.2); 
                color: #2ecc71;
                font-weight: bold;
            }
            .status-warning { 
                background: rgba(243, 156, 18, 0.2); 
                color: #f39c12;
                font-weight: bold;
            }
            .status-critical { 
                background: rgba(231, 76, 60, 0.2); 
                color: #e74c3c;
                font-weight: bold;
            }
            .status-user {
                background: rgba(149, 165, 166, 0.2);
                color: #95a5a6;
                font-weight: bold;
            }
            .info-box {
                background: rgba(52, 152, 219, 0.2);
                border-left: 4px solid #3498db;
                padding: 15px;
                margin: 15px 0;
                border-radius: 5px;
            }
            .refresh-info {
                text-align: center;
                margin-top: 30px;
                color: rgba(255, 255, 255, 0.7);
                font-style: italic;
            }
            .annotations-cell {
                max-width: 300px;
                font-size: 0.85em;
                word-wrap: break-word;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>üîê OpenShift Certificate Discovery</h1>
            <p>Cluster-wide certificate analysis using certificate discovery logic</p>
            <div class="info-box">
                <strong>üìä Generated:</strong> {{ generated_time }} | <strong>Cluster:</strong> {{ cluster_name }}
            </div>
        </div>

        <div class="summary">
            <div class="summary-card">
                <h3>Total Certificates</h3>
                <div class="summary-count">{{ total }}</div>
            </div>
            <div class="summary-card">
                <h3>Platform-Managed</h3>
                <div class="summary-count" style="color: #2ecc71;">{{ platform_managed }}</div>
            </div>
            <div class="summary-card">
                <h3>User-Managed</h3>
                <div class="summary-count" style="color: #95a5a6;">{{ user_managed }}</div>
            </div>
            <div class="summary-card">
                <h3>Auto-Rotated</h3>
                <div class="summary-count" style="color: #3498db;">{{ auto_rotated }}</div>
            </div>
        </div>

        <table class="cert-table">
            <thead>
                <tr>
                    <th>Resource Type</th>
                    <th>Name</th>
                    <th>Namespace</th>
                    <th>Data Fields</th>
                    <th>Validity (Years)</th>
                    <th>Expiry</th>
                    <th>Fingerprint</th>
                    <th>Managed Status</th>
                    <th>Managed Details</th>
                    <th>CA Category</th>
                    <th>Relevant Annotations</th>
                </tr>
            </thead>
            <tbody>
                {% for cert in certificates %}
                <tr>
                    <td>{{ cert.resource_type }}</td>
                    <td><strong>{{ cert.name }}</strong></td>
                    <td>{{ cert.namespace }}</td>
                    <td>{{ cert.data_fields }}</td>
                    <td>{{ cert.validity_years }}</td>
                    <td>{{ cert.expiry }}</td>
                    <td style="font-family: monospace; font-size: 0.8em;">{{ cert.fingerprint[:16] }}...</td>
                    <td class="{% if 'Platform-Managed' in cert.managed_status and 'Auto-Rotated' in cert.managed_status %}status-good{% elif 'Platform-Managed' in cert.managed_status and '10-Year' in cert.managed_status %}status-warning{% elif 'User-Managed' in cert.managed_status %}status-user{% else %}status-critical{% endif %}">
                        {{ cert.managed_status }}
                    </td>
                    <td style="font-size: 0.85em;">{{ cert.managed_details }}</td>
                    <td>{{ cert.ca_category }}</td>
                    <td class="annotations-cell">{{ cert.relevant_annotations }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="refresh-info">
            Page auto-refreshes every 5 minutes | Last updated: {{ generated_time }}
        </div>
    </body>
    </html>
    '''
---
apiVersion: v1
kind: Service
metadata:
  name: cert-discovery-service
  namespace: cert-discovery-app
  labels:
    app: cert-discovery
spec:
  selector:
    app: cert-discovery
  ports:
  - port: 80
    targetPort: 8080
    protocol: TCP
    name: http
  type: ClusterIP
---
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: cert-discovery-route
  namespace: cert-discovery-app
  labels:
    app: cert-discovery
spec:
  to:
    kind: Service
    name: cert-discovery-service
    weight: 100
  port:
    targetPort: 8080
  wildcardPolicy: None

